Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("../utils/constants");
var math_1 = require("../utils/math");
var finish_1 = require("./finish");
var update_1 = require("./update");
exports.tick = function (model, delta, _ctx) {
    var duration = model.duration;
    var repeat = model.repeat;
    var rate = model.rate;
    var time = model.time === constants_1._ ? (rate < 0 ? duration : 0) : model.time;
    var round = model.round || 0;
    var isReversed = rate < 0;
    time += delta * rate;
    var iterationEnded = false;
    if (!math_1.inRange(time, 0, duration)) {
        model.round = ++round;
        time = isReversed ? 0 : duration;
        iterationEnded = true;
        if (model.yoyo) {
            model.rate = (model.rate || 0) * -1;
        }
        time = model.rate < 0 ? duration : 0;
    }
    model.time = time;
    model.round = round;
    if (iterationEnded && repeat === round) {
        finish_1.finish(model, constants_1._, _ctx);
        return;
    }
    update_1.update(model, constants_1._, _ctx);
};
